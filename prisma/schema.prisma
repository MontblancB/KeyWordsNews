datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
  directUrl = env("POSTGRES_URL")
}

generator client {
  provider = "prisma-client-js"
}

model News {
  id           String   @id @default(cuid())
  title        String
  url          String   @unique
  summary      String   @db.Text
  source       String
  category     String
  publishedAt  DateTime
  imageUrl     String?
  isBreaking   Boolean  @default(false)

  // AI 요약 필드
  aiSummary       String?   @db.Text
  aiKeywords      String[]  @default([])
  aiOneLiner      String?   // 한 줄 정리 (20-30자)
  aiSummarizedAt  DateTime?
  aiProvider      String?   // 사용된 AI 프로바이더 (groq, openai, gemini 등)

  // AI 전문가 의견 필드
  aiInsight         String?   @db.Text  // 전문가 의견 내용
  aiInsightExpert   String?             // 전문가 이름/직함
  aiInsightKeywords String[]  @default([]) // 전문가 의견 키워드
  aiInsightAt       DateTime?           // 생성 시간
  aiInsightProvider String?             // 사용된 AI 프로바이더

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category])
  @@index([publishedAt])
  @@index([isBreaking])
  @@index([source])
  @@index([aiSummarizedAt])
  @@index([aiInsightAt])
}

model KeywordMap {
  id          String   @id @default(cuid())

  // 캐시 키 (카테고리 or 키워드별)
  cacheKey    String   @unique  // "category:politics" or "keyword:AI"

  // 분석 데이터 (JSON)
  data        Json     // { keywords: [...], links: [...], metadata: {...} }

  // 메타데이터
  newsCount   Int      // 분석된 뉴스 개수
  generatedAt DateTime @default(now())
  expiresAt   DateTime // 캐시 만료 시간

  // AI 프로바이더
  provider    String   // groq, gemini 등

  @@index([cacheKey])
  @@index([expiresAt])
}
