/**
 * AI 요약 프롬프트 빌더
 * Groq/Gemini/OpenRouter 등 모든 Provider가 공유하는 프롬프트 생성 로직
 */

// 카테고리별 요약 초점
const CATEGORY_FOCUS: Record<string, string> = {
  politics: `**정치 뉴스 요약 초점:**
- 정책의 핵심 변경 사항과 이해관계자(여당/야당/시민단체 등)의 입장을 명시
- 법안/정책의 영향 대상과 규모를 수치로 제시
- 정치적 맥락(선거, 당내 역학 등)을 간략히 언급`,

  economy: `**경제 뉴스 요약 초점:**
- 핵심 수치(주가, 환율, 금리, 성장률 등)를 반드시 포함
- 전일/전월/전년 대비 변화율을 명시
- 시장/산업에 미치는 영향과 원인을 연결`,

  tech: `**IT/과학 뉴스 요약 초점:**
- 기술의 핵심 내용과 기존 대비 차별점을 설명
- 시장 규모, 출시 시기, 적용 분야 등 구체적 정보 포함
- 관련 기업/기관과 경쟁 구도를 간략히 언급`,

  society: `**사회 뉴스 요약 초점:**
- 사건의 경위와 관련자를 구체적으로 명시
- 영향받는 사람들의 규모와 범위를 수치로 제시
- 제도적/구조적 배경을 간략히 설명`,

  world: `**국제 뉴스 요약 초점:**
- 관련 국가/기관과 각각의 입장을 명시
- 국제 정세 맥락(갈등, 동맹, 무역 등)을 간략히 언급
- 한국에 미치는 영향이 있다면 포함`,

  crypto: `**암호화폐 뉴스 요약 초점:**
- 가격 변동, 거래량, 시가총액 등 핵심 수치 포함
- 규제/정책 변화와 시장 반응을 연결
- 관련 프로젝트/기업의 구체적 행보를 명시`,

  sports: `**스포츠 뉴스 요약 초점:**
- 경기 결과, 스코어, 기록 등 핵심 데이터 포함
- 선수/팀의 성적 맥락(시즌 순위, 연속 기록 등)을 언급
- 대회/리그 일정과 향후 전망을 간략히 포함`,

  entertainment: `**연예 뉴스 요약 초점:**
- 작품/활동의 구체적 내용(출연진, 일정, 규모 등) 포함
- 시청률, 음원 차트, 흥행 수치 등 성과 데이터 명시
- 업계 반응이나 팬 반응을 간략히 언급`,

  culture: `**문화 뉴스 요약 초점:**
- 행사/작품의 구체적 내용(일정, 장소, 참여자) 포함
- 문화적 의미나 역사적 맥락을 간략히 설명
- 관람/참여 정보가 있다면 포함`,
}

// 카테고리별 예시
const CATEGORY_EXAMPLES: Record<string, string> = {
  politics: `"• 국회, 반도체특별법 본회의 통과 (찬성 247·반대 3·기권 5)
• 핵심 내용: 반도체 기업 세액공제 25%로 확대, 2027년까지 한시 적용
• 야당 '업계 요구 반영 부족' 비판, 여당 '글로벌 경쟁력 확보 시급' 강조
• 삼성·SK 등 주요 기업 '투자 계획 구체화' 환영 입장 표명"`,

  economy: `"• 한국은행, 기준금리 0.25%포인트 인하 결정 (3.25%→3.00%)
• 소비자물가 상승률 2.1%로 둔화, 내수 부진이 인하 배경
• 원/달러 환율 1,380원대로 소폭 하락, 외국인 채권 매수 유입
• 전문가 '추가 인하 여력 있지만, 가계부채 증가 변수' 분석"`,

  tech: `"• 삼성전자, 3나노 2세대 공정 양산 시작 (수율 70% 이상 확보)
• 경쟁사 대비 6개월 앞선 기술 확보, 파운드리 점유율 확대 기대
• 주요 고객사 퀄컴·엔비디아와 공급 계약 논의 중
• 평택 공장에 3조원 추가 투자, 2027년까지 월 10만 장 생산 목표"`,

  society: `"• 서울시, 2026년부터 1인 가구 긴급생활지원금 월 50만원 지급
• 대상: 중위소득 50% 이하 위기 가구 약 12만 세대
• 기존 제도 사각지대 해소 목적, 신청 절차 간소화 예정
• 전문가 '1인 가구 증가 추세 반영한 시의적절한 정책' 평가"`,

  world: `"• 미·중 정상회담서 반도체 수출 규제 완화 합의 (3월 발효)
• 미국, 성숙 공정(28나노 이상) 장비 수출 허용으로 전환
• 중국 '건설적 대화' 평가, 일본·한국 반도체 업계 수혜 전망
• 전문가 '선거 앞둔 전략적 유화, 첨단 분야 규제는 유지' 분석"`,

  crypto: `"• 비트코인, 10만 달러 돌파 후 24시간 만에 9만8천 달러로 조정
• 거래량 전일 대비 45% 급증, 레버리지 청산 8억 달러 규모
• 미국 현물 비트코인 상장지수펀드 순유입 3일 연속 기록
• 분석가 '단기 과열 조정, 중장기 상승 추세는 유효' 전망"`,

  sports: `"• 손흥민, 시즌 15호골 기록하며 토트넘 2-1 승리 이끌어
• 후반 78분 결승골, 프리미어리그 득점 순위 공동 3위 등극
• 팀 5연승으로 4위 복귀, 챔피언스리그 진출권 경쟁 치열
• 감독 '손흥민의 결정력이 팀의 핵심 자산' 극찬"`,

  entertainment: `"• 넷플릭스 '오징어 게임 3', 공개 첫 주 시청 1억2천만 시간 기록
• 역대 비영어권 시리즈 최고 기록 경신 (전작 대비 35%↑)
• 시즌3 촬영 이미 완료, 2026년 하반기 공개 예정
• 주연 이정재 '시리즈 완결편으로 최고의 결말 준비' 언급"`,

  culture: `"• 국립중앙박물관 '고려, 그 찬란한 도전' 특별전 3월 개막
• 국보·보물 120점 포함 총 350점 전시, 역대 최대 규모
• 프랑스 루브르 소장 고려청자 3점 최초 국내 공개
• 관람료 무료, 사전예약제 운영 (1일 5,000명 제한)"`,

  global: `"• 유럽연합, 탄소국경조정제도 본격 시행 (4월 1일부터)
• 철강·시멘트·알루미늄 등 6개 품목 탄소 비용 부과 시작
• 한국 수출 기업 연간 추가 부담 약 1조2천억원 추산
• 산업부 '기업 지원책 마련 중, 탄소 감축 투자 가속화 필요' 입장"`,
}

// 기본 예시 (카테고리 매칭이 안 될 때)
const DEFAULT_EXAMPLE = `"• 고용부, 2026년 최저임금 시간당 1만2천원 확정 (7.3%↑)
• 노동계 '물가 대비 부족' 반발, 경영계 '중소기업 부담' 우려
• 적용 대상 300만명, 2026.1.1 시행
• 전문가 '소득주도성장 정책, 고용 양극화 가능성' 지적"`

/**
 * 시스템 프롬프트 생성 (비스트리밍)
 */
export function buildSummarizeSystemPrompt(): string {
  return `당신은 뉴스를 간결하고 정확하게 요약하는 전문 기자입니다.

**언어 규칙:**
- 한국어로만 작성합니다
- 영어 약어는 한글로 풀어씁니다 (예: AI→인공지능, GDP→국내총생산, ESG→환경·사회·지배구조)
- 일상적으로 통용되는 한자어는 자연스럽게 사용합니다 (발표, 추진, 시행, 검토, 개선 등)
- 전문 용어는 괄호 안에 쉬운 설명을 덧붙입니다

**요약 원칙:**
- 각 불릿은 하나의 완결된 문장으로, 핵심 정보를 빠짐없이 담되 간결하게
- 5W1H를 포함합니다 (누가, 언제, 어디서, 무엇을, 왜, 어떻게)
- 숫자, 날짜, 금액, 비율, 인명, 기관명 등 구체적 정보를 반드시 포함합니다
- 원인과 결과를 명시합니다
- 주장이나 의견은 출처를 밝힙니다
- 제목 내용을 반복하지 말고 새로운 정보를 우선합니다
- JSON 형식으로 응답합니다`
}

/**
 * 스트리밍용 시스템 프롬프트 (간결 버전, TTFT 최적화)
 */
export function buildStreamSystemPrompt(): string {
  return `뉴스를 3-5개 불릿으로 간결하게 요약하는 전문 기자. 한국어로만 작성, 영어 약어는 한글로 풀어쓰기, 일상적 한자어는 허용. 5W1H 포함, 구체적 정보(숫자/날짜/금액) 필수. JSON 형식 응답.`
}

/**
 * 유저 프롬프트 생성 (카테고리별 초점/예시 포함)
 */
export function buildSummarizePrompt(title: string, content: string, category?: string): string {
  const categoryFocus = category ? CATEGORY_FOCUS[category] || '' : ''
  const categoryExample = category ? (CATEGORY_EXAMPLES[category] || DEFAULT_EXAMPLE) : DEFAULT_EXAMPLE

  return `다음 뉴스 기사를 읽고 핵심 내용을 **3-5개의 간결한 불릿**으로 정리하고, 주요 키워드 3-5개를 추출해주세요.

**요약 규칙:**
1. **오직 한국어로만 작성** - 영어 약어는 한글로 풀어쓰기 (예: AI→인공지능, GDP→국내총생산)
2. **각 불릿은 하나의 완결된 문장** - 핵심 정보를 빠짐없이 담되 간결하게
3. **5W1H 중심 작성** - 누가, 언제, 어디서, 무엇을, 왜, 어떻게
4. **구체적 정보 필수 포함** - 숫자, 날짜, 금액, 비율, 인명, 기관명
5. **인과관계 명시** - 원인과 결과를 간략히
6. **객관적 사실 중심** - 주장이나 의견은 출처 명시
7. 제목 내용 반복 금지, 새로운 정보 위주
8. **3-5개** - 본문 복잡도에 따라 조절 (짧으면 3개, 길면 5개)
${categoryFocus ? `\n${categoryFocus}\n` : ''}
**키워드 선정 기준:**
- 이 뉴스의 핵심 쟁점이나 개념을 나타내는 단어 (단순 고유명사보다 이슈 키워드 우선)
- 관련 뉴스를 더 찾을 때 검색어로 유용한 단어
- 너무 일반적인 단어(정부, 국회, 기업 등) 대신 구체적인 키워드 선택
- 3-5개, 한글로만 작성

제목: ${title}

본문:
${content}

**좋은 요약 예시:**
${categoryExample}

반드시 JSON 형식으로만 응답해주세요:
{
  "summary": "• 포인트1\\n• 포인트2\\n• 포인트3",
  "keywords": ["키워드1", "키워드2", "키워드3"]
}`
}

/**
 * 스트리밍용 유저 프롬프트 (간결 버전)
 */
export function buildStreamPrompt(title: string, content: string, category?: string): string {
  const categoryFocus = category ? CATEGORY_FOCUS[category] || '' : ''

  return `뉴스를 3-5개 불릿으로 요약 (각 불릿은 완결된 문장):
${categoryFocus ? `\n${categoryFocus}\n` : ''}
제목: ${title}

본문:
${content}

JSON 형식:
{
  "summary": "• 불릿1\\n• 불릿2\\n• 불릿3",
  "keywords": ["키워드1", "키워드2", "키워드3"]
}`
}
